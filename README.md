# Практическая работа 4: Асинхронность, Promises, Restful API

## Начало работы

Установите зависимости проекта:

`npm install`

После этого вам будут доступны следующие команды:

 - `npm run lint` - проверка качества вашего кода утилитой ESLint
 - `npm run test [test-file]` - запустить unit-тесты из указанного файла в консоли, например: `npm run test test/spec/task-1.spec.js`
 - `npm run test:all` - запуск всех unit-тестов в консоли
 - `npm run test -- --watch [test-file]`, `npm run test:all -- --watch` - запуск одного или всех unit-тестов в консоли, с автоматическим перезапуском при изменении исходного кода. Например: `npm run test -- --watch test/spec/task-1.spec.js`
 - `npm run test:browser` - запуск всех unit-тестов в браузере
 - `npm run start` - открывает в браузере страничку с необходимой для вашего кода разметкой. При изменении кода страничка автоматически перезагружается.
 
## Задания

### Задача 1
1. `window.fetch()` возвращает промис который благополучно разрешится при любом ответе сервера,
даже если сервер вернет ошибку 404, или 500. Отклоняется промис только в случае проблем с сетью:
когда сеть недоступна или сервер вовсе не прислал никакого ответа. Многие считают такое поведение неинтуитивным.

Давайте так посчитаем и мы, и напишем утилиту `status(response)` для `window.fetch()`, которая будет проверять
код http-ответа сервера.

Если этот код находится в диапазоне 200-299
(в этом случае поле `ok` ответа будет `true`, см. [Response](https://developer.mozilla.org/en/docs/Web/API/Response)),
то ответ просто передается дальше.

Если же сервер отвечает с другим кодом, то `status` должен выбросить ошибку `new Error()`
с описанием взятым из поля `Response.statusText`.

```javascript
window.fetch("blahblahblah.com")
.then(status)
.then(...) // <-- должно выполниться если статус ответа сервера 200-299
.catch(...) // <-- должно выполниться если сервер вернул ошибку
```

2. В случае когда сервер возвращает данные в формате `application/json`, тело ответа представляет собой
строку с сериализованными JSON-данными. После получения эти данные нужно преобразовать в настоящий JS-объект.
Напишите утилиту `json(response)` которая парсит полученные данные из формата JSON и возвращает реальный JS-объект.

```javascript
window.fetch("blahblahblah.com")
.then(json)
.then(data => {. . .}); // data здесь - это уже десериализованные данные
``` 

3. Напишите функцию `getJSON(url)`, которая делает HTTP GET запрос на указанный url,
обрабатывает статус HTTP ответа c помощью `status` и парсит ответ с помощью `json`.

```javascript
getJSON("blahblahblah.com")
.then(data => { . . .}) // data - уже десериализованные данные
.catch( . . . );        // сюда попадем если код ответа не равен 200-299
```
 
### Задача 2
Напишите функцию `getParallel(urls)`, которая принимает массив url,
и вызывает их параллельно с помощью `getJSON`.
Функция возвращает промис, который разрешится при выполнении всех вызовов,
или будет отклонен если любой из вызовов получит отказ.

Промис разрешается в массив ответов.

```javascript
getParallel(["url1", "url2", "url3"])
.then(data => { . . . })   // data - массив из 3 JS-объектов, полученных из JSON-ответов сервера
.catch( . . . );           // сюда попадем только если хотя бы один из запросов был отклонен
```

### Задача 3
Напишите функцию `getSequential(url1, url2)` которая принимает на вход два url.
Вначале она вызывает с помощью `getJSON` первый url. Если запрос выполнился удачно,
то вызывается второй url.

Функция возвращает Promise, который разрешится с массивом из обоих полученных значений.
Например, если первый вызов вернул `"article content"`, а второй `"comments"`,
то результат должен выглядеть как `["article content", "comments"]`.

Кроме того, если первый вызов получит отказ, промис должен быть отклонен со значением
`Error("first fetch failed")`, если второй - отклонен со значением
`Error("second fetch failed")`

### Задача 4
Иногда промисы используют для представления выбора пользователя в диалоговых окнах.
(e.g. "Точно ли вы хотите выйти, ведь при выходе вся ваша несохраненная работа будет потеряна, диск отформатирована, а в качестве аватарки в социальной сети установлено фото из паспорта? да/нет")
Мы ожидаем пока пользователь выберет кнопку, поэтому в представлении этого процесса как асинхронной операции есть некоторая логика.
Для реального проекта это пожалуй не самая хорошая идея, но для учебного задания - вполне.
Напишите функцию `showDialog(dialogId)`, которая показывает диалог с заданным HTML `id`, и возвращает промис.
Промис разрешается если пользователь нажал на кнопку "Yes", отклоняется если пользователь нажал "No".

### Задача 5
Напишите класс `Cart`, который представляет корзину покупок (опять!).
Список покупок теперь, однако, будет сохраняться на сервере.
Класс `Cart` может выполнять CRUD операции над содержимым списка покупок:

```HTTP
GET /cart


### Задача 6
 - Магазин в MVC стиле
 
### Задача 7 (*)
Promise.some
http://bluebirdjs.com/docs/api/promise.some.html

### Задача 8 (*)
`getSequential` с произвольным числом url 
